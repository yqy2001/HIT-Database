## 1、概述

给定SQL查询，经过SQL parser和translator，可以被翻译成一系列有顺序的关系代数表达式。

这些关系代数表达式经过查询优化器，获得更优的查询计划。

之后将这些查询计划送给查询执行器执行。

<img src="https://i.loli.net/2021/05/12/dMx5RGqbcClWzr4.png" alt="image-20210512084445416" style="zoom:50%;" />

## 2、外排序

排序：排序是关系代数操作执行过程的重要步骤

当数据规模大到无法全部载入内存时，需要使用**外排序**算法。

外排序的开销用磁盘I/O次数来衡量，CPU计算时间可近似忽略。故外排序算法的目标就是：最小化I/O次数。

外部归并排序

## 3、关系代数操作的执行

两趟多路外存归并排序：1、创建归并段；2、归并

![image-20210512090058682](https://i.loli.net/2021/05/12/dUIMj1gB4A7oNOT.png)

一些记法：
N: 关系R的元组数
M: 缓冲池中可用内存页数
B: 每块(磁盘中的页)最多存B个元组
B(R) = N/B: R的块数

创建归并段：将关系R划分为B(R)/M个归并段

对R中的每M块，将其读入缓冲池中的M页，对这M页中的所有元组按照排序键进行排序，形成一个归并段。再将该归并段写入文件。

多路归并：将B(R)/M个归并段中的元组进行归并

![image-20210512091122503](https://i.loli.net/2021/05/12/niaP4UzLR3hFCcT.png)

由于要将所有归并段的第一块都读入缓冲池，故归并段的数量一定要小于等于缓冲池能容纳的页数M

算法分析：

输出结果时产生的I/O不计入算法的I/O代价，因为输出可能直接被使用了，不再写入文件。输出缓冲区也不计入可用内存页数。

I/O代价：3B(R)，每一个页进行3次I/O
可用内存页数要求：$B(R)\leqslant M^2$，每个归并段不超过M页，最多M个归并段

## 4、表达式的执行

