## 6.1 物理数据库设计概述

任务：在逻辑数据库设计的基础上，为每个**关系模式**选择合适的存储结构和存取方法，使得数据库上的事务能够高效率地运行。

设计步骤：
1、分析影响物理数据库设计的因素；
2、为关系模式选择存取方法；
3、设计关系、索引等数据库文件的物理存储结构。

## 6.2 索引的设计

索引一般不能在内存中装得下，索引建好了要永久存储，所以一般放在外存，数据结构一般使用B+树。但使用到了会加载一部分到内存中，类似于缓冲。

索引能够帮助DBMS快速找到关系中满足搜索条件的元组。对于查询的比较多的属性建立索引，比如姓名

索引的构成：
索引键：索引根据一组属性来定位元组
索引项：索引中的(键值，地址)对

索引的分类：

* 主索引：索引键是关系的主键；
* 二级索引：索引键不是关系的主键。
  只能有一个主索引，但可以有多个二级索引
* 唯一索引：索引键值不重复
* 非唯一索引：索引键值可重复

前面的索引通常存储元组地址，读取元组需要一次IO

* 聚簇索引：存储的是元组本身，而不是元组的地址，一般一个关系就存一个聚簇索引

区分唯一和非唯一可以优化查询

创建主索引、二级索引：primary key, key, unique, 

外键索引是为了加快参照完整性检查

### 索引数据结构：

#### B+树：

所有叶节点深度相同，索引项存储在叶节点中，按照索引键值**排序**存储。每次取出索引项需要进行树的高度次I/O

支持的查询类型：全值匹配、匹配最左前缀（前面的几个索引属性）、匹配属性前缀、范围匹配、按照索引属性进行排序

限制：若查询结果中元组的索引键值在B+树的叶节点中不连续存储，则B+树不支持该查询
如：没有从最左属性开始查找

#### 哈希索引：

仅支持对所有索引属性的精确匹配，不支持部分索引属性匹配；
只支持等值比较查询，不支持范围查询，无法排序；

伪哈希索引：仅支持等值查询，不支持范围查询；需要改写查询；需要在数据更新时维护哈希值属性。

前缀索引：只索引字符串的前缀，不支持排序和分组查询
索引的选择性：不重复的索引键值和元组数量N之间的比值，选择度越高，索引的过滤能力越强。

若对多个属性建索引，将选择度高的放在前面

聚簇索引：减少磁盘IO；但插入、更新的开销大

## 6.3 物理存储结构的设计

选择数据类型的原则：

* 尽量使用可以正确存储数据的最小数据类型
* 尽量选择简单的数据类型
* 若不需要存储空值，则最好将属性声明为NOT NULL

关系模式的设计：

* 一个关系不要包含太多属性
* 不要使用“实体-属性-值”的设计模式，即为每个属性建立一个关系（需要太多的连接操作）
* 进行合理的纵向拆分

 