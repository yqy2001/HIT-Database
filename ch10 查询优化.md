查询优化的两个阶段：

* 逻辑查询优化：将一个逻辑查询计划转换成另一个具有更低估计代价的逻辑查询计划
* 物理查询优化：在选定的逻辑查询计划基础上，生成一个优化的物理查询计划，使得DBMS能够快速得到结果；比如使用索引

## 逻辑查询优化

1、启发式方法；2、基于代价的方法，使用代价估计模型来估计各个计划的代价。

### 技术1、关系代数表达式的等价变换

选择下推，可以尽早过滤掉与结果无关的元组

<img src="ch10 查询优化.assets/image-20210831095514512.png" alt="image-20210831095514512" style="zoom:50%;" />

先分解再选择下推：

<img src="ch10 查询优化.assets/image-20210831095622581.png" alt="image-20210831095622581" style="zoom:50%;" />

选择度(属性不同值的个数与元组数的比值)高的操作优先做，尽早过滤掉更多与结果无关的元组。

选择操作的结果上是没有索引的，尽量下推到没有索引的那个关系。

投影下推：降低元组大小。
但有些情况下投影下推会浪费查询优化的机会，因为投影结果上没有索引。

### 技术2、估计查询计划的代价

代价用查询计划执行过程中中间结果的元组数来度量：

<img src="ch10 查询优化.assets/image-20210831100831434.png" alt="image-20210831100831434" style="zoom:50%;" />

计算所需的统计信息：$T(R)$关系R的元组数；$V(R,A)$关系R的属性集A的不同值的个数。

**二路自然连接的基数估计：**

<font color='red'>考试考：</font>R和S只有一个连接属性Y：$T(R\join S)=\frac{T(R)T(S)}{max(V(R,Y), V(S,Y))}$

R和S有两个连接属性XY：$T(R\join S)=\frac{T(R)T(S)}{max(V(R,X), V(S,X))max(V(R,Y), V(S,Y))}$

### 技术3、连接顺序优化

